<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Driver Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0/dist/umd/supabase.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+Sinhala:wght@400;700;900&display=swap');

        :root {
            --f1-red: #e10600;
            --f1-black: #050505;
            --sidebar-width: 260px;
        }

        /* Prevent flash of content before auth check */
        [v-cloak] { display: none; }
        body.loading { visibility: hidden; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Orbitron', 'Noto Sans Sinhala', sans-serif;
            background-color: var(--f1-black);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: #000;
            border-right: 1px solid #222;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: #666;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar-item:hover, .sidebar-item.active {
            color: white;
            background: rgba(225, 6, 0, 0.05);
            border-left-color: var(--f1-red);
        }

        .sidebar-item svg {
            margin-right: 1rem;
            width: 18px;
            height: 18px;
        }

        /* Main Content area */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        .card {
            background: #111;
            border: 1px solid #222;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: border-color 0.3s;
        }

        .card:hover {
            border-color: var(--f1-red);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--f1-red);
        }

        /* Course Specific Styling */
        .course-card {
            background: #111;
            border: 1px solid #222;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .course-card:hover {
            border-color: var(--f1-red);
            transform: translateY(-5px);
        }

        .course-img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-bottom: 1px solid #222;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .course-card:hover .course-img {
            opacity: 1;
        }

        .course-card .badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 10px;
            padding: 2px 8px;
            background: var(--f1-red);
            font-weight: 900;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
            z-index: 10;
        }

        .f1-btn {
            background: transparent;
            border: 1px solid #333;
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-size: 0.7rem;
            font-weight: 900;
            text-transform: uppercase;
            transition: all 0.3s;
            clip-path: polygon(5% 0, 100% 0, 95% 100%, 0% 100%);
            cursor: pointer;
        }

        .course-card:hover .f1-btn {
            background: var(--f1-red);
            border-color: var(--f1-red);
        }

        .progress-bar {
            height: 4px;
            background: #222;
            width: 100%;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--f1-red);
        }

        /* View Switching Logic */
        .view-section {
            display: none;
            animation: fadeIn 0.4s ease forwards;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Notification/Message Toast */
        #toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--f1-red);
            color: white;
            padding: 1rem 2rem;
            font-weight: 900;
            font-style: italic;
            text-transform: uppercase;
            font-size: 0.75rem;
            clip-path: polygon(5% 0, 100% 0, 95% 100%, 0% 100%);
            transform: translateY(200%);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }

        #toast.visible { transform: translateY(0); }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: var(--f1-red); }

        .motivation-sinhala {
            font-family: 'Noto Sans Sinhala', sans-serif;
            line-height: 1.6;
        }
    </style>
</head>
<body class="loading">

    <!-- Toast UI -->
    <div id="toast">System Alert</div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="p-6 mb-8">
            <h1 class="text-xl font-black italic tracking-tighter text-white">
                F1 <span class="text-red-600">HUB</span>
            </h1>
            <p class="text-[10px] text-gray-500 tracking-[3px] uppercase mt-1">Telemetry System</p>
        </div>

        <nav class="flex flex-col gap-1">
            <div class="sidebar-item active" id="nav-overview" onclick="switchView('overview')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                Overview
            </div>
            <div class="sidebar-item" id="nav-courses" onclick="switchView('courses')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                Courses
            </div>
            <div class="sidebar-item" id="nav-motivation" onclick="switchView('motivation')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Motivation
            </div>
            
            <div class="mt-auto pt-10">
                <div class="sidebar-item text-red-500" onclick="handleLogout()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    Logout
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Mobile Header -->
        <div class="md:hidden flex justify-between items-center mb-8">
            <button onclick="toggleSidebar()" class="p-2 text-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
            <h1 class="text-lg font-black italic">F1 HUB</h1>
        </div>

        <!-- Global Header -->
        <header class="flex flex-col md:flex-row md:items-end justify-between mb-10 gap-4">
            <div>
                <h2 class="text-4xl font-black italic mb-2">HELLO, <span id="driver-name" class="text-red-600">DRIVER</span></h2>
                <p class="text-xs text-gray-500 uppercase tracking-widest" id="user-display">CONNECTING...</p>
            </div>
            <div class="flex gap-4">
                <div class="bg-zinc-900 px-4 py-2 border-r-2 border-red-600 min-w-[120px]">
                    <p class="text-[10px] text-gray-500 uppercase">Current Time</p>
                    <p class="text-xs font-bold" id="current-time">00:00:00</p>
                    <p class="text-[8px] text-gray-400" id="current-date">--- -- ----</p>
                </div>
                <div class="bg-zinc-900 px-4 py-2 border-r-2 border-red-600">
                    <p class="text-[10px] text-gray-500 uppercase">Mental State</p>
                    <p class="text-xs font-bold text-green-500">PEAK PERFORMANCE</p>
                </div>
            </div>
        </header>

        <!-- SECTION: OVERVIEW -->
        <section id="section-overview" class="view-section active">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="card flex flex-col justify-center">
                    <p class="text-[10px] uppercase text-red-600 font-black mb-1 tracking-[2px]">Race Countdown</p>
                    <p id="race-countdown" class="stat-value !text-4xl font-black tabular-nums">00:00:00:00</p>
                    <p class="text-[8px] text-gray-500 uppercase tracking-[4px] mt-1">Days : Hours : Minutes : Seconds</p>
                </div>

                <div class="card flex flex-col justify-center border-l-4 border-red-600">
                    <p class="text-[10px] uppercase text-gray-500 font-bold mb-2 tracking-widest">Today's Motivation</p>
                    <p id="daily-motivation-snippet" class="motivation-sinhala text-sm italic text-white/90">Loading wisdom...</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card bg-zinc-900/50">
                    <h3 class="font-bold uppercase text-sm mb-6 border-b border-white/10 pb-2">Active Modules</h3>
                    <div class="space-y-4" id="active-modules-list">
                        <p class="text-[10px] text-gray-500 animate-pulse">SYNCING DATA...</p>
                    </div>
                </div>

                <div class="card bg-zinc-900/50">
                    <h3 class="font-bold uppercase text-sm mb-6 border-b border-white/10 pb-2">Track Alerts</h3>
                    <div class="space-y-4" id="track-alerts-list">
                        <p class="text-[10px] text-gray-500 animate-pulse">FETCHING ALERTS...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: COURSES -->
        <section id="section-courses" class="view-section">
            <div class="flex gap-4 mb-8 overflow-x-auto pb-2">
                <button class="text-[10px] font-bold px-4 py-2 bg-red-600 text-white uppercase italic">All Programs</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="courses-container">
                <div class="col-span-full py-20 text-center">
                    <p class="text-xs text-gray-500 animate-pulse tracking-[5px]">INITIALIZING DATA STREAM...</p>
                </div>
            </div>
        </section>

        <!-- SECTION: MOTIVATION -->
        <section id="section-motivation" class="view-section">
            <div class="max-w-4xl mx-auto">
                <div class="flex items-center gap-4 mb-8">
                    <div class="h-1 w-12 bg-red-600"></div>
                    <h2 class="text-3xl font-black italic uppercase">Driver Motivation</h2>
                </div>

                <div class="card bg-zinc-900/40 p-10 border-t-4 border-red-600">
                    <div class="mb-8">
                        <svg class="w-12 h-12 text-red-600 opacity-30 mb-4" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.8954 14.9124 16 16.017 16H19.017V14H14.017V5H22.017V16C22.017 18.7614 19.7784 21 17.017 21H14.017ZM2.01697 21L2.01697 18C2.01697 16.8954 2.91241 16 4.01697 16H7.01697V14H2.01697V5H10.017V16C10.017 18.7614 7.7784 21 5.01697 21H2.01697Z"></path></svg>
                        <p id="motivation-main-text" class="motivation-sinhala text-2xl md:text-3xl font-bold leading-relaxed tracking-wide text-white">
                            සෑම පියවරක්ම ඔබව ජයග්‍රහණය කරා ගෙන යයි.
                        </p>
                    </div>
                    
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 pt-8 border-t border-white/10">
                        <div>
                            <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">Today's Focus</p>
                            <p id="motivation-date" class="text-xs font-black italic text-red-600">-- --- ----</p>
                        </div>
                        <button onclick="refreshMotivation()" class="text-[10px] font-bold border border-white/20 px-6 py-2 hover:bg-white hover:text-black transition-all uppercase italic">
                            Next Thought
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // CONFIGURATION
        const GOOGLE_SHEET_ID = '1HLQxJv32eo-EloTtdZhw5ZhEWIXuhMOI7OAKsqG-dfI';
        const GOOGLE_API_KEY = 'AIzaSyD3sts8y_s8M8L2Y66Gz0ICY_9SY-VmoEo';
        const COURSES_SHEET = 'courses';
        const NOTICES_SHEET = 'notice';

        const sinhalaQuotes = [
            "ජයග්‍රහණය පවතින්නේ උත්සාහය අත් නොහරින පුද්ගලයා සතුවයි.",
            "අද ඔබ කරන සුළු කැපවීම හෙට දවසේ විශාල ජයග්‍රහණයක් වනු ඇත.",
            "කාලය කළමනාකරණය කරගන්න, එවිට ලෝකය ඔබව සොයා එනු ඇත.",
            "සිහින දැකීම නවත්වන්න එපා, මන්ද සිහින යනු අනාගතයේ මාලිමාවයි.",
            "වෙනස ආරම්භ විය යුත්තේ ඔබෙන්මයි.",
            "ජීවිතයේ අභියෝග යනු ඔබව ශක්තිමත් කරන මෙවලම් මිස බාධක නොවේ.",
            "අසාර්ථකත්වය යනු නැවත ආරම්භ කිරීමට ලැබුණු තවත් එක් අවස්ථාවක් පමණි.",
            "ඔබේ හැකියාවන් පිළිබඳව සැක නොකරන්න, ඔබ සතුව ලෝකය වෙනස් කිරීමේ ශක්තිය ඇත.",
            "හොඳම පළිගැනීම වන්නේ ඔබ බලාපොරොත්තු නොවන තරම් විශාල ජයග්‍රහණයක් ලැබීමයි.",
            "සෑම අඳුරු රාත්‍රියකටම පසුව දීප්තිමත් හිරු උදාවක් පවතියි.",
            "ඔබේ ගමන සෙමින් වුවත් කමක් නැත, වැදගත් වන්නේ ඔබ නතර නොවීමයි.",
            "වැටෙන වාරයක් පාසා නැගිටින්න, එවිට ලෝකය ඔබට ඉඩ ලබා දෙනු ඇත.",
            "දක්ෂතාවයට වඩා කැපවීම සැමවිටම ජයග්‍රහණය කරයි.",
            "ඔබේ මනස පාලනය කරගන්න, එවිට ඔබට ඕනෑම දෙයක් ජයගත හැක.",
            "අද දවස මග නොහරින්න, එය ඔබට ලැබුණු වටිනාම තෑග්ගයි.",
            "ඉලක්කය වෙත අවධානය යොමු කරන්න, බාධක දෙස නොව.",
            "ලෝකය වෙනස් කිරීමට පෙර ඔබව වෙනස් කරගන්න.",
            "අන් අය පවසන දේට වඩා ඔබේ හෘද සාක්ෂියට ඇහුම්කන් දෙන්න.",
            "ධෛර්යවන්ත මිනිසා යනු බිය නොවන පුද්ගලයා නොව බිය ජයගන්නා පුද්ගලයායි.",
            "අනාගතය නිර්මාණය වන්නේ අද ඔබ කරන තීරණ මතයි.",
            "කිසිවක් කළ නොහැකි යැයි සිතන තුරු එය කළ නොහැකි දෙයක් ලෙස පවතියි.",
            "දුෂ්කර මාවත් සැමවිටම සුන්දර ගමනාන්තයන් වෙත ඔබව රැගෙන යයි.",
            "සාර්ථකත්වය රහසක් නොවේ, එය වෙහෙස මහන්සි වී වැඩ කිරීමේ ප්‍රතිඵලයකි.",
            "අනුන්ගේ අඩිපාරේ යනවාට වඩා ඔබේම අනන්ූයතාවයක් ගොඩනගන්න.",
            "විශ්වාසය යනු අඩක් දිනීමයි.",
            "සතුට යනු ගමනාන්තයක් නොව ගමනක් බව වටහා ගන්න.",
            "විවේකය අවශ්‍යයි, නමුත් අත්හැරීම කිසිවිටකත් විකල්පයක් කර නොගන්න.",
            "ඉවසීම යනු සාර්ථකත්වයේ යතුරයි.",
            "අතීතය පාඩමක් කරගන්න, අනාගතය අරමුණක් කරගන්න.",
            "අද දින ඔබ දක්වන උනන්දුව හෙට දින ඔබේ ආඩම්බරය වනු ඇත.",
            "ශක්තිමත් මනසක් යනු ඕනෑම තරඟයක හොඳම එන්ජිමයි."
        ];

        // SUPABASE SETUP
        const SUPABASE_URL = 'https://ogfmimplmjzhqzeeexae.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9nZm1pbXBsbWp6aHF6ZWVleGFlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNTgzNzcsImV4cCI6MjA4NjYzNDM3N30.l8j1VC7-Zt88UGRkclBd-dNyLZsHg2DuY_9FRRW311o';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // NAVIGATION FUNCTIONS
        window.switchView = function(viewName) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            const targetSection = document.getElementById(`section-${viewName}`);
            const targetNav = document.getElementById(`nav-${viewName}`);
            if (targetSection) targetSection.classList.add('active');
            if (targetNav) targetNav.classList.add('active');
            if (window.innerWidth < 768) {
                const sb = document.getElementById('sidebar');
                if (sb) sb.classList.remove('open');
            }
        };

        window.toggleSidebar = function() {
            const sb = document.getElementById('sidebar');
            if (sb) sb.classList.toggle('open');
        };

        window.refreshMotivation = function() {
            const el = document.getElementById('motivation-main-text');
            if (el) {
                const rand = Math.floor(Math.random() * sinhalaQuotes.length);
                el.innerText = sinhalaQuotes[rand];
            }
        };

        // UI HELPERS
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.classList.add('visible');
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 3000);
        }

        // Action function for courses
        window.enterSimulation = function(courseName) {
            showToast(`CONNECTING TO SIMULATOR: ${courseName.toUpperCase()}`);
            // Logic to redirect or open simulation could go here
            // e.g., window.location.href = `lesson.html?course=${courseName}`;
        };

        window.handleLogout = async function() {
            try {
                await supabaseClient.auth.signOut();
                window.location.href = 'login.html';
            } catch (err) {
                window.location.href = 'login.html';
            }
        };

        // AUTH GUARD & INITIALIZATION
        async function checkUserSession() {
            const { data: { session }, error } = await supabaseClient.auth.getSession();
            
            if (error || !session) {
                window.location.href = 'login.html';
                return;
            }

            const user = session.user;
            const name = user.user_metadata.full_name || user.email.split('@')[0];
            
            document.getElementById('user-display').innerText = `ID: ${user.email.toUpperCase()}`;
            document.getElementById('driver-name').innerText = name.toUpperCase();
            
            document.body.classList.remove('loading');
            
            fetchCoursesFromSheet();
            fetchNoticesFromSheet();
            initMotivation();
            startClocks();
        }

        function initMotivation() {
            const now = new Date();
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const quoteIndex = dayOfYear % sinhalaQuotes.length;
            const quote = sinhalaQuotes[quoteIndex];
            
            const snipEl = document.getElementById('daily-motivation-snippet');
            const mainEl = document.getElementById('motivation-main-text');
            const dateEl = document.getElementById('motivation-date');

            if (snipEl) snipEl.innerText = quote;
            if (mainEl) mainEl.innerText = quote;
            if (dateEl) dateEl.innerText = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }).toUpperCase();
        }

        async function fetchCoursesFromSheet() {
            const container = document.getElementById('courses-container');
            const moduleList = document.getElementById('active-modules-list');
            if (!container || !moduleList) return;

            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/${COURSES_SHEET}!A2:E100?key=${GOOGLE_API_KEY}`);
                const data = await response.json();
                if (!data.values) throw new Error('No data');

                container.innerHTML = '';
                moduleList.innerHTML = '';

                data.values.forEach((row, index) => {
                    const [id, name, instructor, description, imageUrl] = row;
                    const card = document.createElement('div');
                    card.className = 'course-card';
                    card.innerHTML = `
                        <img src="${imageUrl || 'https://images.unsplash.com/photo-1544654803-b69110bb8154?auto=format&fit=crop&q=80&w=800'}" 
                             class="course-img" alt="${name}" 
                             onerror="this.src='https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&q=80&w=800'">
                        <span class="badge">PROGRAM ${id}</span>
                        <div class="p-6 flex flex-col flex-1">
                            <h3 class="text-lg font-black italic mb-1">${name ? name.toUpperCase() : 'UNTITLED'}</h3>
                            <p class="text-[9px] text-red-600 font-bold mb-3 uppercase tracking-tighter">Instructor: ${instructor || 'N/A'}</p>
                            <p class="text-[11px] text-gray-400 mb-6 leading-relaxed flex-1">${description || 'No description provided.'}</p>
                            <div class="mt-auto">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-[9px] text-gray-500 font-bold uppercase">Progress</span>
                                    <span class="text-[9px] text-red-600 font-bold">0%</span>
                                </div>
                                <div class="progress-bar"><div class="progress-fill" style="width: 0%;"></div></div>
                                <button class="f1-btn w-full mt-6" onclick="enterSimulation('${name.replace(/'/g, "\\'")}')">Enter Simulation</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);

                    if (index < 3) {
                        const moduleItem = document.createElement('div');
                        moduleItem.className = 'flex items-center justify-between p-3 bg-black/40 rounded border border-white/5';
                        moduleItem.innerHTML = `
                            <span class="text-xs font-bold">${name}</span>
                            <button class="text-[10px] bg-red-600 px-2 py-1 rounded font-black hover:bg-white hover:text-red-600 transition-colors" onclick="switchView('courses')">START</button>
                        `;
                        moduleList.appendChild(moduleItem);
                    }
                });
            } catch (err) {
                console.error('Sheet Fetch Error (Courses):', err);
                container.innerHTML = `<p class="col-span-full text-center text-red-600 text-xs font-bold py-10">DATA STREAM OFFLINE</p>`;
            }
        }

        async function fetchNoticesFromSheet() {
            const alertsList = document.getElementById('track-alerts-list');
            if (!alertsList) return;

            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/${NOTICES_SHEET}!A2:D100?key=${GOOGLE_API_KEY}`);
                const data = await response.json();
                
                if (!data.values || data.values.length === 0) {
                    alertsList.innerHTML = '<p class="text-[10px] text-gray-500">NO ACTIVE ALERTS</p>';
                    return;
                }

                alertsList.innerHTML = '';
                const reversedNotices = [...data.values].reverse();

                reversedNotices.forEach(row => {
                    const [title, content, link, timestamp] = row;
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'flex items-start gap-4 p-3 bg-black/20 rounded border-l-2 border-yellow-500 hover:bg-black/40 transition-all';
                    
                    let actionButton = link && link.trim() !== '' ? `
                        <a href="${link}" target="_blank" class="inline-block mt-2 px-3 py-1 bg-zinc-800 hover:bg-red-600 text-[9px] font-bold uppercase transition-colors rounded">
                            View Details
                        </a>
                    ` : '';

                    alertDiv.innerHTML = `
                        <div class="w-2 h-2 rounded-full bg-yellow-500 mt-1 shrink-0"></div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-1">
                                <p class="text-xs font-bold uppercase tracking-tight">${title || 'NOTICE'}</p>
                                <span class="text-[8px] text-gray-600 font-bold whitespace-nowrap ml-2">${timestamp || 'N/A'}</span>
                            </div>
                            <p class="text-[10px] text-gray-400 leading-tight">${content || ''}</p>
                            ${actionButton}
                        </div>
                    `;
                    alertsList.appendChild(alertDiv);
                });
            } catch (err) {
                console.error('Sheet Fetch Error (Notices):', err);
                alertsList.innerHTML = '<p class="text-[10px] text-red-600 font-bold uppercase">ALERTS OFFLINE</p>';
            }
        }

        function startClocks() {
            function update() {
                const now = new Date();
                const clockEl = document.getElementById('current-time');
                const dateEl = document.getElementById('current-date');
                const countdownEl = document.getElementById('race-countdown');

                if (clockEl) clockEl.innerText = now.toLocaleTimeString('en-GB', { hour12: false });
                if (dateEl) dateEl.innerText = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }).toUpperCase();

                if (countdownEl) {
                    const targetDate = new Date('2026-08-10T08:30:00');
                    const diff = targetDate - now;
                    if (diff > 0) {
                        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const s = Math.floor((diff % (1000 * 60)) / 1000);
                        const pad = (num) => String(num).padStart(2, '0');
                        countdownEl.innerText = `${pad(d)}:${pad(h)}:${pad(m)}:${pad(s)}`;
                    } else {
                        countdownEl.innerText = "SESSION LIVE";
                    }
                }
            }
            setInterval(update, 1000);
            update();
        }

        // Initialize Guard on Load
        window.addEventListener('load', checkUserSession);
    </script>
</body>
</html>
