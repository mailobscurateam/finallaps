<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Simulation | Lesson Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --f1-red: #e10600;
            --f1-black: #050505;
        }

        body {
            background-color: var(--f1-black);
            color: white;
            font-family: 'Orbitron', sans-serif;
        }

        .lesson-row {
            border-left: 4px solid transparent;
            background: linear-gradient(90deg, #111 0%, #050505 100%);
            transition: all 0.2s ease;
        }

        .lesson-row:hover {
            border-left-color: var(--f1-red);
            background: linear-gradient(90deg, #1a1a1a 0%, #0a0a0a 100%);
            transform: translateX(10px);
        }

        .status-badge {
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Navigation / Header -->
        <nav class="flex items-center justify-between mb-12 border-b border-zinc-800 pb-6">
            <a href="dashboard.html" class="text-[10px] text-zinc-400 hover:text-white flex items-center gap-2 uppercase font-black transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path></svg>
                Back to Paddock
            </a>
            <div class="text-right">
                <h1 id="course-title" class="text-2xl md:text-3xl font-black italic uppercase tracking-tighter">Loading Simulation...</h1>
                <p id="course-id-display" class="text-[10px] text-red-600 font-bold tracking-widest uppercase mt-1"></p>
            </div>
        </nav>

        <!-- Lessons Container -->
        <div id="lessons-list" class="space-y-4">
            <!-- Shimmer effect for loading -->
            <div class="h-20 bg-zinc-900/50 animate-pulse rounded"></div>
            <div class="h-20 bg-zinc-900/50 animate-pulse rounded"></div>
            <div class="h-20 bg-zinc-900/50 animate-pulse rounded"></div>
        </div>
    </div>

    <script>
        const GOOGLE_SHEET_ID = '1HLQxJv32eo-EloTtdZhw5ZhEWIXuhMOI7OAKsqG-dfI';
        const GOOGLE_API_KEY = 'AIzaSyD3sts8y_s8M8L2Y66Gz0ICY_9SY-VmoEo';
        const LESSONS_SHEET = 'lessons'; 

        // 1. Get CourseID from URL or Default to 'finallaps'
        const urlParams = new URLSearchParams(window.location.search);
        const selectedCourseId = urlParams.get('id') || 'finallaps';

        async function fetchLessons() {
            const listContainer = document.getElementById('lessons-list');
            const titleDisplay = document.getElementById('course-title');
            const idDisplay = document.getElementById('course-id-display');

            idDisplay.innerText = `Sector: ${selectedCourseId}`;

            try {
                // Fetch lessons data (A: CourseID, B: Lesson Title, C: Type, D: Duration)
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/${LESSONS_SHEET}!A2:D100?key=${GOOGLE_API_KEY}`);
                const data = await response.json();

                if (!data.values) {
                    listContainer.innerHTML = `<p class="text-center text-zinc-500 py-20">No data found in lesson telemetry.</p>`;
                    return;
                }

                // 2. Filter lessons matching the selectedCourseId
                const filteredLessons = data.values.filter(row => row[0] === selectedCourseId);

                if (filteredLessons.length === 0) {
                    listContainer.innerHTML = `<p class="text-center text-zinc-500 py-20 uppercase text-xs tracking-[0.2em]">Zero lessons matched Course ID: ${selectedCourseId}</p>`;
                    titleDisplay.innerText = "Simulation Empty";
                    return;
                }

                // Update Header with Course Name (stored in localStorage from previous page as fallback)
                const savedName = localStorage.getItem('selectedCourseName');
                titleDisplay.innerText = savedName || "Course Curriculum";

                listContainer.innerHTML = '';
                filteredLessons.forEach((row, index) => {
                    const title = row[1];
                    const type = row[2] || "Technical";
                    const duration = row[3] || "N/A";

                    const lessonDiv = document.createElement('div');
                    lessonDiv.className = 'lesson-row p-6 flex items-center justify-between group cursor-pointer';
                    lessonDiv.innerHTML = `
                        <div class="flex items-center gap-6">
                            <span class="text-zinc-700 font-black italic text-2xl">${String(index + 1).padStart(2, '0')}</span>
                            <div>
                                <h3 class="font-bold uppercase tracking-tight group-hover:text-red-500 transition-colors">${title}</h3>
                                <p class="text-[9px] text-zinc-500 font-bold uppercase tracking-widest mt-1">${duration} â€¢ EST. COMPLETION</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="status-badge bg-zinc-800 text-[9px] font-bold px-3 py-1 uppercase tracking-tighter text-zinc-400">
                                ${type}
                            </span>
                            <div class="w-8 h-8 rounded border border-zinc-800 flex items-center justify-center group-hover:border-red-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-zinc-600 group-hover:text-red-500"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm36.44-94.66-48-32A8,8,0,0,0,104,96v64a8,8,0,0,0,12.44,6.66l48-32a8,8,0,0,0,0-13.32Z"></path></svg>
                            </div>
                        </div>
                    `;
                    listContainer.appendChild(lessonDiv);
                });

            } catch (err) {
                listContainer.innerHTML = `<p class="text-center text-red-600 py-20 font-black uppercase tracking-[0.3em]">Critical: Telemetry Dropout</p>`;
                console.error(err);
            }
        }

        window.addEventListener('load', fetchLessons);
    </script>
</body>
</html>
