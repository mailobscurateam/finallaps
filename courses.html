<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>F1 Course Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+Sinhala:wght@400;700;900&display=swap');

        :root {
            --f1-red: #e10600;
            --f1-black: #050505;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Orbitron', 'Noto Sans Sinhala', sans-serif;
            background-color: var(--f1-black);
            color: white;
            min-height: 100vh;
        }

        .f1-border-bottom {
            border-bottom: 4px solid var(--f1-red);
            clip-path: polygon(0 0, 100% 0, 98% 100%, 0% 100%);
        }

        .module-card {
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .module-card:hover {
            border-color: var(--f1-red);
            background: #111;
            transform: translateX(5px);
        }

        .status-badge {
            font-size: 8px;
            padding: 2px 8px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-back {
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #666;
            transition: color 0.2s;
        }

        .btn-back:hover { color: var(--f1-red); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: var(--f1-red); }

        .loading-screen {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s;
        }

        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .scanner {
            position: absolute;
            width: 100%;
            height: 2px;
            background: var(--f1-red);
            box-shadow: 0 0 15px var(--f1-red);
            animation: scan 2s linear infinite;
            opacity: 0.3;
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-screen">
        <div class="scanner"></div>
        <div class="text-center">
            <h1 class="text-xl font-black italic tracking-tighter">LOADING <span class="text-red-600">SIMULATION</span></h1>
            <div class="mt-4 w-48 h-1 bg-zinc-800 mx-auto overflow-hidden">
                <div class="h-full bg-red-600 animate-[loading_1.5s_ease-in-out_infinite]" style="width: 30%"></div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <!-- Header Navigation -->
        <nav class="flex items-center justify-between mb-12">
            <a href="dashboard.html" class="btn-back flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" stroke-width="3"></path></svg>
                Return to Paddock
            </a>
            <div class="text-right">
                <p class="text-[8px] text-red-600 font-black tracking-widest uppercase">System Encrypted</p>
                <p class="text-[10px] font-bold" id="sim-time">00:00:00</p>
            </div>
        </nav>

        <!-- Course Identity -->
        <header class="mb-12">
            <div class="f1-border-bottom pb-4 mb-4">
                <p id="course-id-label" class="text-[10px] text-gray-500 font-black tracking-[4px] uppercase">COURSE_ID: NULL</p>
                <h1 id="course-title" class="text-3xl md:text-5xl font-black italic uppercase tracking-tighter">LOADING...</h1>
            </div>
            <div class="flex flex-wrap gap-4 text-[9px] font-bold uppercase tracking-widest text-gray-400">
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500"></span> Simulator Active</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> HD Content Enabled</span>
                <span class="flex items-center gap-1" id="module-count">0 Modules Detected</span>
            </div>
        </header>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Module List -->
            <div class="lg:col-span-2">
                <h3 class="text-xs font-black uppercase text-red-600 mb-6 tracking-widest">Training Modules</h3>
                <div id="module-container" class="space-y-4">
                    <!-- Modules will be injected here -->
                </div>
            </div>

            <!-- Right: Progress/Stats -->
            <div class="space-y-6">
                <div class="bg-zinc-900/30 p-6 border border-zinc-800">
                    <h3 class="text-[10px] font-black uppercase mb-6 tracking-widest">Driver Statistics</h3>
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-[9px] mb-2 uppercase font-bold">
                                <span>Completion</span>
                                <span class="text-red-600">0%</span>
                            </div>
                            <div class="w-full h-1 bg-zinc-800">
                                <div class="bg-red-600 h-full w-0"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[9px] mb-2 uppercase font-bold">
                                <span>Session Time</span>
                                <span id="session-timer">00:00</span>
                            </div>
                            <div class="w-full h-1 bg-zinc-800">
                                <div class="bg-zinc-600 h-full w-1/3"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-red-600 p-6 italic">
                    <h4 class="font-black text-sm uppercase leading-none mb-2">Sim Notice</h4>
                    <p class="text-[10px] font-bold leading-relaxed">Ensure your telemetry link is stable before starting high-load video modules.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_SHEET_ID = '1HLQxJv32eo-EloTtdZhw5ZhEWIXuhMOI7OAKsqG-dfI';
        const GOOGLE_API_KEY = 'AIzaSyD3sts8y_s8M8L2Y66Gz0ICY_9SY-VmoEo';
        
        // This is where you'd link to your specific "Course Details" or "Curriculum" sheet
        const CURRICULUM_SHEET = 'curriculum'; 

        async function initPage() {
            const courseId = localStorage.getItem('selectedCourseId');
            const courseName = localStorage.getItem('selectedCourseName');

            if (!courseId) {
                window.location.href = 'dashboard.html';
                return;
            }

            document.getElementById('course-id-label').innerText = `COURSE_ID: ${courseId}`;
            document.getElementById('course-title').innerText = courseName || 'UNNAMED SIMULATION';

            await fetchCurriculum(courseId);
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => document.getElementById('loading').style.display = 'none', 500);
            }, 1000);

            startSimTimers();
        }

        async function fetchCurriculum(courseId) {
            const container = document.getElementById('module-container');
            try {
                // In a real scenario, you'd filter by courseId in the API call or JS
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/${CURRICULUM_SHEET}!A2:E100?key=${GOOGLE_API_KEY}`);
                const data = await response.json();
                
                if (!data.values) {
                    container.innerHTML = `<p class="text-zinc-600 text-xs italic">No specific curriculum found for this simulation.</p>`;
                    return;
                }

                // Filter modules that belong to this courseId (assuming column A is course_id)
                const modules = data.values.filter(row => row[0] === courseId);
                
                document.getElementById('module-count').innerText = `${modules.length} Modules Detected`;

                if (modules.length === 0) {
                    container.innerHTML = `<p class="text-zinc-600 text-xs italic">No specific curriculum found for this simulation.</p>`;
                    return;
                }

                container.innerHTML = '';
                modules.forEach((mod, idx) => {
                    // Structure: [course_id, module_title, module_type, content_link, duration]
                    const [_, title, type, link, duration] = mod;
                    
                    const div = document.createElement('div');
                    div.className = 'module-card p-5 flex items-center justify-between group';
                    div.onclick = () => window.open(link, '_blank');
                    div.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="text-zinc-700 font-black italic text-2xl group-hover:text-red-600 transition-colors">${String(idx + 1).padStart(2, '0')}</div>
                            <div>
                                <h4 class="text-xs font-black uppercase tracking-tight">${title}</h4>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="status-badge bg-zinc-800 text-zinc-400">${type}</span>
                                    <span class="text-[8px] text-zinc-600 font-bold uppercase">${duration || 'Variable Time'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="opacity-0 group-hover:opacity-100 transition-opacity text-red-600">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </div>
                    `;
                    container.appendChild(div);
                });

            } catch (err) {
                container.innerHTML = `<p class="text-red-600 text-[10px] font-bold">TELEMETRY LINK INTERRUPTED</p>`;
            }
        }

        function startSimTimers() {
            let seconds = 0;
            setInterval(() => {
                const now = new Date();
                document.getElementById('sim-time').innerText = now.toLocaleTimeString('en-GB', { hour12: false });
                
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('session-timer').innerText = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }, 1000);
        }

        window.addEventListener('load', initPage);
    </script>
</body>
</html>
